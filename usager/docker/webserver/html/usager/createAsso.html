<!DOCTYPE html>
<html lang="">
<head>
  <title>Create New Asso</title>
  <style>
    body {
      background-color: white;
      font-family: "Lato", sans-serif;
      color: grey;
    }

    .notification {
      position: fixed;
      right: 20px;
      top: 50px;
      background-color: #4CAF50;
      color: white;
      padding: 15px;
      border-radius: 4px;
      transition: opacity 0.6s, top 0.5s;
      opacity: 0;
      z-index: 1000000;
    }

    .asso-form {
      width: 500px;
      margin: 0 auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .asso-form select,
    .asso-form input[type="text"],
    .asso-form button[type=button] {
      width: 100%;
      padding: 12px 20px;
      margin: 8px 0;
      display: inline-block;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    .asso-form button[type=button] {
      background-color: #4CAF50;
      color: white;
      border: none;
      cursor: pointer;
    }
    .asso-form button[type=button]:hover {
      background-color: #45a049;
    }

    .sidenav {
      height: 100%;
      width: 0;
      position: fixed;
      z-index: 3;
      top: 0;
      left: 0;
      background-color: #0B4F00;
      overflow-x: hidden;
      transition: 0.5s;
      padding-top: 60px;
    }

    .sidenav a {
      padding: 8px 8px 8px 32px;
      text-decoration: none;
      font-size: 25px;
      color: #5BFF5E;
      display: block;
      transition: 0.3s;
      z-index: 3;
    }

    .sidenav a:hover {
      color: #f1f1f1;
      z-index: 3;
    }

    .sidenav .closebtn {
      position: absolute;
      top: 0;
      right: 25px;
      font-size: 36px;
      margin-left: 50px;
      z-index: 3;
    }

    @media screen and (max-height: 450px) {
      .sidenav {padding-top: 15px;}
      .sidenav a {font-size: 18px;}
    }

    /* Center the title */
    h2 {
      text-align: center;
    }

    /* Change the color of the hamburger icon and 'UNIVENT' text to green */
    #openNavSpan {
      color: #45a049;
    }
  </style>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="http://localhost:8180/js/keycloak.js"></script>
  <script>
    function submitAsso() {
      var Asso_Etudiante_Nom = document.getElementById('Asso_Etudiante_Nom').value;
      var FaculteID = document.getElementById('FaculteID').value;
      var UsagerID = document.getElementById('UsagerID').value;

      if (Asso_Etudiante_Nom.length === 0) { // Check for an empty string
      showNotification("Mettez un nom d'association");
      return;
    }

      var asso = {
        Asso_Etudiante_Nom: Asso_Etudiante_Nom,
        FaculteID: FaculteID,
        UsagerID: UsagerID
      };

      axios.post('http://localhost:8888/api/Asso', asso, {
        headers: {
          'Content-Type': 'application/json',
        }
      })
              .then(function(response) {
                if (response.status === 201) {
                  showNotification("Association created!");
                  window.location.href = 'master_manager.html';
                }else {
                  showNotification(response.status);
                }
              })
              .catch(function(error) {
                console.error(error);
                showNotification("Assurez vous que l'admin existe et que l'id n'est pas encore utilisé ");
              });
    }

    function logout() {
      window.location.href = "http://localhost:8180//realms/usager/protocol/openid-connect/logout"
    }

    function openNav() {
      document.getElementById("mySidenav").style.width = "250px";
      document.getElementById("user-info").classList.add("fade-in");
    }

    function closeNav() {
      document.getElementById("mySidenav").style.width = "0";
      document.getElementById("user-info").classList.remove("fade-in");
    }

  </script>
</head>
<body>
<div id="mySidenav" class="sidenav">
  <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
  <a href="master_manager.html">Accueil</a>
  <a href="#" onclick="logout()">Déconnexion</a>
</div>

<span id="openNavSpan" style="font-size: 40px; font-weight: bold; cursor: pointer; position: absolute; top: 0; left: 0.5%;" onclick="openNav()">&#9776; UNIVENT</span>

<h2>Create New Asso</h2>
<div class="asso-form">
  <form>

    <label for="Asso_Etudiante_Nom">AssoEtudiante Name:</label><br>
    <input type="text" id="Asso_Etudiante_Nom" name="Asso_Etudiante_Nom"><br>

    <label for="FaculteID">AssoEtudiante Fac:</label><br>
    <select id="FaculteID" name="FaculteID"></select><br>


    <label for="UsagerID">AssoEtudiante admin:</label><br>
    <select id="UsagerID" name="UsagerID"></select><br>

    <button type="button" onclick="submitAsso()">Submit</button>

    <script>

      function populateFaculteOptions() {
        axios.get('http://localhost:8888/api/Asso/getAllFaculteData', {
          headers: {
            'Content-Type': 'application/json'
          }
        })
                .then(function(response) {
                  var faculteData = response.data; // La réponse doit être un objet avec noms et ID de facultés
                  var select = document.getElementById('FaculteID');

                  faculteData.forEach(function(faculte) {
                    var option = document.createElement('option');
                    option.value = faculte.id;
                    option.textContent = faculte.name;
                    select.appendChild(option);
                  });
                })
                .catch(function(error) {
                  console.error(error);
                  showNotification("Erreur lors de la récupération des facultés.");
                });
      }

      function showNotification(message) {
        var notification = document.createElement('div');
        notification.className = 'notification';
        notification.textContent = message;

        document.body.appendChild(notification);

        // After adding to the DOM, change the style to trigger the CSS transition
        setTimeout(function() {
          notification.style.opacity = 1;
          notification.style.top = '50px';
        }, 20);

        // Remove the notification after 3 seconds
        setTimeout(function() {
          notification.style.opacity = 0;
          notification.style.top = '20px';

          setTimeout(function() {
            document.body.removeChild(notification);
          }, 600);
        }, 3000);
      }

      function populateUsagerOptions() {
        axios.get('http://localhost:8888/api/Asso/getUsagerID', {
          headers: {
            'Content-Type': 'application/json'
          }
        })
                .then(function(response) {
                  var usagerIDs = response.data; // La réponse doit être une liste de chaînes de caractères (identifiants d'utilisateurs)
                  var select = document.getElementById('UsagerID');

                  usagerIDs.forEach(function(usagerID) {
                    var option = document.createElement('option');
                    option.value = usagerID;
                    option.textContent = usagerID;
                    select.appendChild(option);
                  });
                })
                .catch(function(error) {
                  console.error(error);
                  showNotification("Erreur lors de la récupération des administrateurs.");
                });
      }

      // Appelez les fonctions pour charger les options lors du chargement de la page
      window.onload = function() {
        populateUsagerOptions();
        populateFaculteOptions();
      };

    </script>

  </form>
</div>
</body>
</html>